---
title: "Data Analysis Replication Assignment 2024"
author: "Jamie Wiener"
date: "04-08-2024"
output:
    html_document
---

## Packages Used
```{r echo=FALSE}
library(tidyverse)
library(dplyr)
library(mosaic)
library(radiant)
library(sciplot)
library(infer)
library(tidylog)
library(data.table)
library(readxl)
library(gt)
library(gtsummary)
library(ggplot2)
library(formatR)
library(knitr)
library(kableExtra)
```


## Introduction

[Include a brief summary of the paper you are reanalyzing data from (e.g., the overall objective of the paper, the types of data collected and how sampling was done, what the main results were) and lay out what you intend to replicate.]

## Visualization of Data

Here, I'm loading the dataset from Dunham *et al*. (2020).
```{r}
f <- "data/Dunham et al. (2020) dataset.xlsx"
d <- read_excel(f,sheet = 1, col_names = TRUE)
```

```{r, echo = TRUE}
(head(d)) #For a view of the first few lines of the data set
```

Various kinematic and substrate variables and were calculated by Dunham *et al*. (2020) from the data available in their published dataset (pp. 3-4). 

The variable relative branch diameter (**relBrnchDiamNsTl**) is a ratio of the branch diameter relative to primate body length measure from nose to base of tail (p. 4). Dunham *et al*. (2020) used these relative branch diameter ratios to group substrate into three size categories: small ("less than half of an individual’s trunk diameter"), medium ("between half and equal to an individual’s trunk diameter"), and large ("greater than an individual’s trunk diameter") (p. 4). Here, I am adding a new variable to my dataset, **relBrnchDiamCategories**, to categorize substrate for each observation as described above.

```{r}
d <- d |> mutate(relBrnchDiamCategories = case_when(
  relBrnchDiamNsTl > 1 ~ "Large",
  relBrnchDiamNsTl >= 0.5 & relBrnchDiamNsTl <= 1 ~ "Medium",
  relBrnchDiamNsTl < 0.5 ~ "Small",
  TRUE ~ NA
  ))
d$relBrnchDiamCategories <- as.factor(d$relBrnchDiamCategories) #As factor because this is a categorical variable with levels.
(levels(d$relBrnchDiamCategories))
```

The variables sine of substrate orientation angle (**Sin_SbstOrient**) and cosine of substrate orientation angle (**Cos_SbstOrient**) are transformations of the raw substrate orientation angle measurement in degrees (Dunham et al., 2020, p. 4). Dunham *et al*. (2020) used these to group substrate into three orientation categories: horizontal ("between -30 and 30 deg"), decline ("less than -30 deg"), and incline ("greater than 30 deg") (p. 4). Here, I am adding a new variable to my dataset, **SbstOrientCategories**, to categorize substrate for each observation as described above. The choice to use **Sin_SbstOrient** to calculate orientation angle is because, unlike **Cos_SbstOrient**, it can differentiate declines and inclines (p. 4).

```{r}
d$Sin_SbstOrient_Numeric <- as.numeric(d$Sin_SbstOrient) #Changing Sin_SbstOrient to numeric
d$Angle_SbstOrient <- (asin(d$Sin_SbstOrient_Numeric))*(180/pi) #Converting sin to angle (deg)

d <- d |> mutate(SbstOrientCategories = case_when(
  Angle_SbstOrient >= -30 & Angle_SbstOrient <= 30 ~ "Horizontal",
  Angle_SbstOrient < -30 ~ "Decline",
  Angle_SbstOrient > 30 ~ "Incline",
  TRUE ~ NA
  ))

d$SbstOrientCategories <- as.factor(d$SbstOrientCategories) #As factor because this is a categorical variable with levels.
(levels(d$SbstOrientCategories))
```

Because only Genus in included as a column in the published dataset, I decided to add columns both for species (**Species**) and binomial nomenclature (**Binomial**).

```{r}
d <- d |> mutate(Species = case_when( #Creating new variable, Species
  Genus == "Cebuella" ~ "pygmaea",
  Genus == "Saguinus" ~ "tripartitus"
  ))
d <- d |> mutate(Binomial = paste(Genus, Species, sep = " ")) #Creating new variable, Binomial, by concatenating **Genus** and **Species** using paste()
```

Dunham *et al*. (2020) define the variables relative forelimb lead duration (**relFLldMS**) and relative hindlimb lead duration (**relHLldMS**) represent "the interval between touchdowns within a limb girdle divided by the total contact duration of the limb girdle" (p. 4). Dunham *et al*. (2020) used these to differentiate symmetrical gaits ("temporal lag between the left and right limbs in each girdle amounted to 50±10% of stride duration") from asymmetrical gaits (values outside the symmetrical gait range) (p. 3). Within asymmetrical gaits, these variables were additionally used to differentiate bounds (both forelimb and hindlimb stance periods were nearly simultaneous), half-bounds (hindlimb stance periods were nearly simultaneous
but forelimb stance periods were staggered), and gallops (both forelimb and hindlimb stance periods were staggered) (p. 3).

Here, I am first adding two new columns to my dataset, **FL** and **HL**, to store whether forelimb touchdowns and hindlimb touchdowns, respectively, were simultaneous ("the interval between the trailing and leading limb mid-support was ≤10% of total limb pair contact duration") or staggered ("the interval between the trailing and leading limb mid-support was
≥10% of total limb pair contact duration") for each observation (Dunham *et al.*, 2020, p. 3). Following from this, I am adding a new variable, **GaitType2**, which categorizes each observation as a symmetrical gait, a bound, a half-bound, or a gallop (p. 3).

```{r}
d <- d |> #Categorizing forelimb stance periods as nearly simultaneous or staggered based on relative forelimb lead duration, relFLldMS
  mutate(FL = case_when(
    relFLldMS <= 0.1 ~ "simultaneous",
    relFLldMS > 0.1 ~ "staggered"
  ))
d <- d |> #Categorizing hindlimb stance periods as nearly simultaneous or staggered based on relative hindlimb lead duration, relHLldMS
  mutate(HL = case_when(
    relHLldMS <= 0.1 ~ "simultaneous",
    relHLldMS > 0.1 ~ "staggered"
  ))

d <- d |> mutate(GaitType2 = case_when( #Categorizing gait types based on both forelimb and hindlimb stance periods
  `Gait Type` == "Sym" ~ "Symmetrical",
  FL == "simultaneous" & HL == "simultaneous" ~ "Bound",
  FL == "staggered" & HL == "simultaneous" ~ "Half-bound",
  FL == "staggered" & HL == "staggered" ~ "Gallop"
))
```

Here, I am attempting to recreate "**Table 1**. Number of strides for different substrate diameter and orientation categories in free-ranging *Saguinus tripartitus* and *Cebuella pygmaea*" using the updated dataset (p. 4). Dunham *et al*. (2020) clarify that each observation in the dataset represents one stride (n = 209) (p. 3).

```{r}
tab1a <- (table(d$Binomial,d$relBrnchDiamCategories))
```

```{r}
tab1b <- (table(d$Binomial,d$SbstOrientCategories))
```

```{r}
tab1 <- cbind(tab1a,tab1b)
tab1 <- kable(tab1, caption = "Table 1. Number of strides for different substrate diameter and orientation categories in free-ranging *Saguinus tripartitus* and *Cebuella pygmaea*") |> 
        add_header_above(c(" " = 1, "Substrate diameter" = 3, "Substrate orientation" = 3)) |>
        kable_styling(full_width = FALSE) %>%
        row_spec(0, extra_css = "margin-bottom: 10px;")
(tab1)
```



## Statistical Replications/Reanalysis

[Be sure to **thoroughly** explain what replications you are doing and comment your code so that it is easy for a reader to understand. Include in this section relevant tables/figures/values from the original paper for comparison to what you accomplished with your replication. Note that I want you to do the bulk of any *exposition* using text and markdown syntax outside of code blocks. That is, your document should not just be one big code block with ***R*** style comments but rather a nicely formatted report with code separated from exposition, interpretation, and dicussion.]

## Summary/Discussion

[Narrative section that overviews how successful were you at replicating the analyses and visualizations in the study. What problems did you encounter? Why might you have encountered those problems? What details were lacking from the original study's methods that might have hampered your ability to replicate the authors' results?]

## References

Dunham, N. T., McNamara, A., Shapiro, L. J., Phelps, T., & Young, J. W. (2020). Asymmetrical gait kinematics of free-ranging callitrichine primates in response to changes in substrate diameter and orientation. *J Exp Biol 15*, *223*(12), jeb217562. https://doi.org/10.1242/jeb.217562

Dunham, N. T., McNamara, A., Shapiro, L. J., Phelps, T., Young, J. W. (2020). Dunham et al.  "Asymmetrical gait kinematics of free-ranging callitrichines in response to changes in substrate diameter and orientation". *figshare*. Dataset. https://doi.org/10.6084/m9.figshare.11923122.v1
